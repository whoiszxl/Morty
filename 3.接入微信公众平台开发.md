# 接入微信公众平台开发

## 功能模块
1. 微信菜单
2. 会员登录 --> 静默登录,授权登录,绑定账号

## 步骤
1. 去微信公众平台注册服务号或者测试号,去基本配置中配置服务器信息,配置自己服务器的URL地址,配置token,如果使用安全模式的话,需要使用EncodingAESKey,当前使用明文模式.
2. 其中需要认证服务器,需要将token,timestamp,nonce随机数 三个参数进行字典排序,然后拼成一个进行sha1加密,然后对比微信加密签名signature是否一致.
3. 在项目中新建weixin modules,创建Msg控制器,index方法,在其中编辑微信验证的代码,代码如下.
```php
class MsgController extends BaseWebController{
    
    public function actionIndex(){
        
        if(!$this->checkSignature()){
            return "error signature";
        }

        //微信第一次认证
        if(array_key_exists("echostr",$_GET) && $_GET["echostr"]){
            return $_GET["echostr"];
        }
    }


    public function checkSignature() {
        $signature = trim($this->get("signature",""));
        $timestamp = trim($this->get("timestamp",""));
        $nonce = trim($this->get("nonce",""));
        $tmpArr = array(\Yii::$app->params['weixin']['token'],$timestamp,$nonce);
        sort($tmpArr);
        $tmpStr = implode($tmpArr);
        $tmpStr = sha1($tmpStr);

        if($tmpStr == $signature){
            return true;
        }else{
            return false;
        }

    }
}

```
4. 在微信后台输入token和url地址就可以直接验证了.
5. 接通外网可以用natapp,ngork,自建vps服务器等方法.